# devcontainer-template

## 品質保証ポリシー

コードの品質は、`pyproject.toml` に定義されたルールセットによって担保されます。

### 1. Lint/Format (Ruff)

Ruff を使用してコードを静的解析します。業界標準の Black 互換ルールに基づき、行長や引用符スタイルなども統一します。

| 項目              | 詳細                                                                                                                |
|:------------------|:--------------------------------------------------------------------------------------------------------------------|
| **ポリシー**      | PEP8 準拠 + FastAPI 公式設定 + Black 互換の自動整形 をベースにチェック。                                            |
| **自動修正/整形** | VS Code でファイル保存時にフォーマット（整形）とインポート順序のみが自動で適用。Linterのエラー修正は手動で実施。 |

- Ruff 公式ルール: https://beta.ruff.rs/docs/rules/
- FastAPI + Ruff 設定例: [FastAPI GitHub pyproject.toml](https://github.com/tiangolo/fastapi/blob/0.120.0/pyproject.toml#L212)

#### 1.1. FastAPI Ruff 設定との差分

本テンプレートでは、FastAPI 公式 Ruff 設定 をベースに、以下の理由で一部ルールを追加・除外しています。

**select ルールの差分**

| ルール                | テンプレート設定 | FastAPI 公式設定 | 詳細                                                                                       |
|:----------------------|:-----------------|:-----------------|:-------------------------------------------------------------------------------------------|
| `N` (pep8-naming)     | 適用             | 適用なし         | 関数・変数・クラス名の命名規則をチェック。公式は特に指定なし。                             |
| `I` (isort)           | 適用なし         | 適用             | インポート順序チェック。`I` ルールは Formatter に組み込まれているため、`select` から除外。 |
| `C4` (comprehensions) | 適用なし         | 適用             | リストや辞書内包表記の簡略化チェック。必要に応じて導入を検討。                             |

**ignore ルールの差分**

| ルール   | テンプレート設定 | FastAPI 公式設定 | 詳細                                                                                   |
|:---------|:-----------------|:-----------------|:---------------------------------------------------------------------------------------|
| `ANN101` | 除外             | 除外なし         | `self` の型ヒントを無視。冗長と判断し除外。                                            |
| `ANN102` | 除外             | 除外なし         | `cls` の型ヒントを無視。冗長と判断し除外。                                             |
| `C901`   | 除外なし         | 除外             | 循環的複雑度チェック。保守性とテスト容易性を優先するため、複雑な関数は許容しない方針。 |
| `W191`   | 除外なし         | 除外             | タブインデント警告。プロジェクトはスペース統一のため不要。                             |

#### 1.2. 実行コマンド

```bash
# Linter を実行（自動修正はされない）
uv run ruff check

# Lint エラーを CLI で修正する場合
uv run ruff check --fix

# フォーマットのみ適用
uv run ruff format
```

### 2. 型安全性 (Pyright)

* **型チェックレベル**: `standard` モード。すべての関数、メソッド、変数に型アノテーションを付与。
* **AWS 対応**: `boto3-stubs` の導入により、AWS SDK 呼び出しにも静的型チェック可能。

#### 2.1. 実行コマンド
```bash
uv run pyright
```

### 3. テストとカバレッジ

* **テスト実行**: `pytest`
* **カバレッジ**: テスト実行時にカバレッジを計測し、`coverage.xml` と `coverage-html/` にレポート出力。

#### 3.1. 実行コマンド
```bash
uv run pytest
```