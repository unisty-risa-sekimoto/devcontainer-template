# devcontainer-template

FastAPI + DynamoDB の開発環境テンプレートです。

## 1. リポジトリ構成

| ファイル/ディレクトリ | 役割                     | 詳細                                                                                               |
|:----------------------|:-------------------------|:---------------------------------------------------------------------------------------------------|
| `.devcontainer/`      | 開発コンテナの構成定義   | VS Code の Dev Containers 機能の設定ファイル群。コンテナビルド時の依存関係や拡張機能の導入を定義。 |
| `.vscode/`            | ワークスペース設定       | VS Code 全体で共有される設定（拡張機能、フォーマッタ、Lint 実行ルールなど）を定義。                |
| `.env`                | 環境変数ファイル         | DynamoDB Local への接続情報を設定済み。                                                            |
| `pyproject.toml`      | プロジェクト設定         | Python の依存関係、Ruff / Pyright / pytest / coverage などの設定を一元管理。                          |
| `uv.lock`             | 依存関係のバージョン固定 | `uv` により解決されたライブラリのバージョンを固定。                                                |


## 2. Lint / Format (Ruff)

Ruff を使用してコードを静的解析します。  

**PEP8 準拠** + **Black 互換** + **FastAPI 公式 Ruff 設定**をベースにルールを設定しています。  
ルール設定は、品質担保を目的とした最小限の構成としています。

### 動作概要
| 項目       | 詳細                                                                                                                        |
|:-----------|:----------------------------------------------------------------------------------------------------------------------------|
| エラー検出 | VS Code 上でリアルタイムに検出。                                                                                            |
| 自動整形   | VS Code 保存時にフォーマットとインポート順序を自動で適用。整形ルールは Black 互換（行長：88文字、引用符：ダブルクォート）。 |
| 修正方法   | Linter エラーは自動修正されないため、手動または CLI で `--fix` を明示実行する。                                             |

### ルール設定

ルールの設定は `pyproject.toml` に定義されています。  
各ルールの詳細は以下を参照してください。
- Ruff 公式ルール一覧: https://beta.ruff.rs/docs/rules/


#### 補足事項

FastAPI が設定している Ruff の設定をベースにしていますが、一部ルールに差分があります。
- FastAPI 公式 - Ruff 設定: [FastAPI GitHub pyproject.toml](https://github.com/fastapi/fastapi/blob/0.120.0/pyproject.toml#L212-L227)

  - **select ルールの差分**

    | ルール                       | テンプレート | FastAPI 公式 | 備考                                                                                               | 参考 |
    |:-----------------------------|:-------------|:-------------|:---------------------------------------------------------------------------------------------------|:-----|
    | `N` (pep8-naming)            | 適用         | 適用なし     | 関数・変数・クラス名の命名規則をチェック。                                                         |      |
    | `ANN` (flake8-annotations)   | 適用         | 適用なし     | 型アノテーションを必須とし、型安全性を確保するために適用。                                         |      |
    | `I` (isort)                  | 適用なし     | 適用         | インポート順序チェック。Formatter に組み込まれているため、`select` からは除外。                    |      |
    | `C4` (comprehensions)        | 適用なし     | 適用         | リストや辞書内包表記の簡略化チェック。可読性向上が目的のため除外（必要に応じて導入を検討）。       | [flake8-comprehensions](https://pypi.org/project/flake8-comprehensions/) |

  - **ignore ルールの差分**

    | ルール   | テンプレート | FastAPI 公式 | 備考                                                                                      | 参考 |
    |:---------|:-------------|:-------------|:------------------------------------------------------------------------------------------|:-----|
    | `C901`   | 除外なし     | 除外         | 複雑度の高い関数チェック。保守性とテスト容易性を優先し、複雑な関数は許容しない方針。      | [complex-structure (C901)](https://docs.astral.sh/ruff/rules/complex-structure/#complex-structure-c901) |
    | `W191`   | 除外なし     | 除外         | タブインデント警告。スペース統一のため不要。                                              |      |


### CLI 実行例

```bash
# Linter を実行（修正なし）
uv run ruff check

# 自動修正を含めて実行
uv run ruff check --fix

# フォーマットのみ実施
uv run ruff format
```

## 3. 型安全性 (Pyright)

Pyright により、静的型チェックを実施します。  
型アノテーションを必須とし、関数・クラス・変数の型安全性を担保します。  

| 項目           | 詳細                                                  |
|:---------------|:------------------------------------------------------|
| モード         | standard                                              |
| エラー検出     | VS Code の Pylance により、リアルタイムに検出。       |
| 補助ライブラリ | `boto3-stubs` により AWS SDK 呼び出しも型解析が可能。 |

### CLI 実行例

```bash
# 型チェックを実施
uv run pyright
```

## 4. テスト（pytest）

単体テストは `pytest`、カバレッジ測定は `coverage` により実施します。  
カバレッジ結果は、`coverage.xml` と `coverage-html/` にレポート出力されます。

### CLI 実行例

```bash
uv run pytest
```